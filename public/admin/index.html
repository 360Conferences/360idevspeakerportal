<html ng-app="AdminApp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Angular Material style sheet -->
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-sanitize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-messages.min.js"></script>
    <!-- Angular Material Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>
    <!-- AngularFire -->
    <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
    <script src="/js/admin-app.js"></script>
    <script src="/js/factories.js"></script>
    <!-- ngCSV Export -->
    <script src="/js/ng-csv.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/app-default.css">
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyBox_RvfqnAPxCMZCmAbeE7KEkjQ0Isqa0",
        authDomain: "speakers.360andev.com",
        databaseURL: "https://andev-app.firebaseio.com",
        storageBucket: "andev-app.appspot.com",
        messagingSenderId: "190191541520"
      };
      firebase.initializeApp(config);
    </script>
  </head>

  <body class="site-content-body" ng-controller="AuthCtrl" ng-cloak layout="column">
    <md-toolbar id="admin-toolbar" class="site-content-toolbar">
      <div class="md-toolbar-tools">
        <h2 flex md-truncate>{{config.event_name}} {{config.event_year}} Admin</h2>
        <md-menu>
          <md-button class="md-icon-button" aria-label="More"
                     ng-click="$mdOpenMenu()"
                     ng-show="firebaseUser">
            <md-icon md-menu-origin>more_vert</md-icon>
          </md-button>
          <md-menu-content width="3">
            <md-menu-item>
              <p>{{firebaseUser.email}}</p>
            </md-menu-item>
            <md-menu-divider></md-menu-divider>
            <md-menu-item>
              <md-button ng-csv="exportProfiles()" filename="profiles.csv">Export Profiles</md-button>
            </md-menu-item>
            <md-menu-item>
              <md-button ng-click="logoutUser()">Log Out</md-button>
            </md-menu-item>
          </md-menu-content>
        </md-menu>
      </div>
      <md-tabs ng-show="validAdminUser" md-selected="tabs.selectedIndex" md-stretch-tabs="always">
        <md-tab id="tab1" aria-controls="tab1-content">Profiles</md-tab>
        <md-tab id="tab2" aria-controls="tab2-content">Submissions</md-tab>
        <md-tab id="tab3" aria-controls="tab3-content">Schedule</md-tab>
      </md-tabs>
    </md-toolbar>

    <md-content layout-padding flex>
      <!-- Logged Out View -->
      <div ng-hide="firebaseUser" class="md-inline-panel">
        <md-card md-theme="cardTheme">
          <md-toolbar>
            <div class="md-toolbar-tools">
              <h3 flex md-truncate>Login Required</h3>
            </div>
          </md-toolbar>
          <md-content layout-padding>
            <div layout="column" layout-align="center center">
              <img src="/images/logo-banner.png" />
              <p>
                If you don't know where you are right now, you probably
                shouldn't be here.
              </p>
              <md-button class="md-raised md-primary"
                         ng-click="loginUser()">Sign In With Google</md-button>
            </div>
          </md-content>
        </md-card>
      </div>

      <!-- Logged In View -->
      <div ng-show="firebaseUser" layout="column">

        <!-- Invalid User Card -->
        <md-card ng-hide="validAdminUser" md-theme="cardTheme" class="md-inline-panel" flex>
          <md-toolbar>
            <div class="md-toolbar-tools">
              <h3 flex md-truncate>Invalid Admin</h3>
            </div>
          </md-toolbar>
          <md-content layout-padding>
            <p>
              I hate to tell you this, but your account is not a valid admin
              account. You really shouldn't be here right now.
            </p>
          </md-content>
        </md-card>

        <!-- Real Content View -->
        <div ng-show="validAdminUser">
          <ng-switch on="tabs.selectedIndex" class="tabpanel-container">
            <!-- Speaker Tab -->
            <div role="tabpanel" id="tab1-content" aria-labelledby="tab1" ng-switch-when="0"
                 md-swipe-left="tabs.next()" md-swipe-right="tabs.previous()"
                 ng-controller="ProfileCtrl">
              <h2>Profile Count: {{ profilesList.length }}</h2>
              <md-card md-theme="cardTheme" ng-repeat="item in profilesList track by item.$id">
                <md-content ng-controller="ProfileItemCtrl">

                  <md-list-item class="md-2-line"
                                layout="row" layout-align="center center"
                                ng-click="showProfileDetail($event,item,avatarUrl)">
                    <div>
                      <img class="profile-image" width="64px" height="64px"
                           src="{{avatarUrl}}" ng-init="getAvatarUrl(item)" />
                    </div>
                    <div class="md-list-item-text" layout="column">
                      <h3>{{ item.name }}</h3>
                      <p style="white-space: pre-line;">{{ item.company }}</p>
                    </div>
                  </md-list-item>

                </md-content>
              </md-card>

            </div>
            <!-- Submission Tab -->
            <div role="tabpanel" id="tab2-content" aria-labelledby="tab2" ng-switch-when="1"
                 md-swipe-left="tabs.next()" md-swipe-right="tabs.previous()"
                 ng-controller="SubmissionCtrl">
              <div layout="row">
                <h2 flex>Submission Count: {{ submissionsList.length }}
                  ({{ sessions.length }} accepted)</h2>
                <md-input-container class="md-block">
                  <label>Sort By</label>
                  <md-select ng-model="sortProperty">
                    <md-option ng-repeat="option in sortOptions" ng-value="option.value">
                      {{option.label}}
                    </md-option>
                  </md-select>
                </md-input-container>
              </div>
              <md-card md-theme="cardTheme"
                       ng-repeat="item in submissionsList | orderBy:getSortParam:reverseSort track by item.$id">
                <md-list-item class="md-2-line"
                              layout="row" layout-align="center center"
                              ng-click="showSubmissionDetail($event,item,profiles[item.speaker_id])">
                 <div class="score-container">
                   <h2>{{scores[item.$id] | number:1}}</h2>
                 </div>
                 <div class="md-list-item-text" layout="column" layout-padding>
                   <div style="padding: 0px;" layout="row">
                     <h3 flex><strong>{{ $index+1 }}.</strong> {{ item.title }}</h3>
                     <md-icon ng-show="item.comments">comment</md-icon>
                   </div>

                   <h4 style="padding: 0px;">{{ profiles[item.speaker_id].name }}</h4>
                   <p style="padding: 0px;">{{ item.abstract | limitTo:256 }}{{ item.abstract.length > 256 ? '...' : '' }}</p>
                 </div>
                 <!-- Admin control to mark a talk accepted -->
                 <md-switch ng-model="item.accepted"
                            ng-change="onTalkSelectionChanged(item)"/>
                </md-list-item>
              </md-card>

            </div>
            <!-- Schedule Tab -->
            <div role="tabpanel" id="tab3-content" aria-labelledby="tab3" ng-switch-when="2"
                 md-swipe-left="tabs.next()" md-swipe-right="tabs.previous()"
                 ng-controller="ScheduleCtrl">

              <div layout="column">
                <!-- Schedule view -->
                <div layout="row" flex>
                  <div ng-repeat="date in config.event_dates" layout="column" flex>
                    <!-- List of talks, filtered and sorted by date -->
                    <h2>{{ date }}</h2>
                    <md-card md-theme="cardTheme"
                             ng-repeat="item in scheduleList | filter: {start_time: date} | orderBy: 'start_time'">
                      <md-list-item class="md-2-line"
                                    layout="row" layout-align="center center">
                       <div class="md-list-item-text" layout="column" layout-padding>
                         <h3 style="padding: 0px;" flex>{{ submissions[item.submission_id].title }}</h3>
                         <h4 style="padding: 0px;">{{ profiles[item.speaker_id].name }}</h4>
                         <h4 style="padding: 0px;">
                           {{ item.start_time | date:'HH:mm' }}, {{ config.venue_rooms[item.room] }}
                         </h4>
                       </div>
                       <md-button style="min-width: 48px;" class="md-icon-button" aria-label="Delete"
                                  ng-click="clearScheduleItem(item)">
                         <md-icon>close</md-icon>
                       </md-button>
                      </md-list-item>
                    </md-card>
                  </div>
                </div>
                <!-- Selected talks list -->
                <md-content>
                  <h2>Unscheduled Talks</h2>
                  <!-- List remaining talks without a schedule item -->
                  <md-card md-theme="cardTheme"
                           ng-repeat="item in sessions">
                    <md-list-item class="md-2-line"
                                  layout="row" layout-align="center center"
                                  ng-hide="schedule[item.$id]"
                                  ng-click="updateScheduleItem($event,item,profiles[item.speaker_id])">
                     <div class="md-list-item-text" layout="column" layout-padding>
                       <h3 style="padding: 0px;" flex>{{ item.title }}</h3>
                       <h4 style="padding: 0px;">{{ profiles[item.speaker_id].name }}</h4>
                     </div>
                     <md-icon class="md-primary"
                              ng-hide="isSpeakerUnique(item)">people_outline</md-icon>
                    </md-list-item>
                  </md-card>
                </md-content>
              </div>
            </div>
          </ng-switch>
        </div>

      </div>
    </md-content>
  </body>
</html>
